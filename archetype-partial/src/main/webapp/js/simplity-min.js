var POCOL={CHAR_ENCODING:"UTF-8",SERVICE_NAME:"_serviceName",USER_TOKEN:"_userToken",FILE_NAME:"_fileName",FILE_NAME_FOR_LOGS:"_logs",MIME_TYPE:"_mimeType",DISCARD_FILE:"_discard",REQUEST_STATUS:"_requestStatus",FILE_TOKEN:"_fileToken",TRACE_FIELD_NAME:"_trace",MESSAGES:"_messages",STATUS_OK:"ok",STATUS_NO_LOGIN:"noLogin",STATUS_ERROR:"error",SERVICE_EXECUTION_TIME:"_serviceExecutionTime",MESSAGE_SUCCESS:"success",MESSGAE_INFO:"info",MESSAGE_WARNING:"warning",MESSAGE_ERROR:"error",TABLE_ACTION_FIELD_NAME:"_saveAction",TABLE_ACTION_ADD:"add",TABLE_ACTION_MODIFY:"modify",TABLE_ACTION_DELETE:"delete",TABLE_ACTION_SAVE:"save",EQUAL:"=",NOT_EQUAL:"!=",LESS:"<",LESS_OR_EQUAL:"<=",GREATER:">",GREATER_OR_EQUAL:">=",LIKE:"~",STARTS_WITH:"^",BETWEEN:"><",IN_LIST:"@",TO_FIELD_SUFFIX:"To",COMPARATOR_SUFFIX:"Comparator",SORT_COLUMN_NAME:"_sortColumns",SORT_ORDER:"_sortOrder",SORT_ORDER_ASC:"asc",SORT_ORDER_DESC:"desc",PAGINATION_SERVICE:"_p",PAGE_SIZE_SUFFIX:"PageSize",TOTAL_COUNT_SUFFIX:"TotalCount",PAGINATION_TABLE:"_tableName",PAGINATION_SIZE:"_pageSize",PAGINATION_PAGE_NUMBER:"_pageNumber",LIST_SERVICE_KEY:"_key",SUGGEST_STARTING:"_matchStarting",ALL_FIELDS:"_allFields",COL_MARKER:"__",IDX_MARKER:"i",DATA_TABLE:"data-table",DATA_ROW:"data-row",HAS_CHILDREN:"data-has-children",HIDE_IF_NO_DATA:"data-hide-if-no-data",LAST_JSON:"_lastJson",LOCAL_STORAGE_NAME:"_localData",LOCAL_SERVICES:"_localServices",LOCAL_RESPONSES:"_localResponses"};var Simplity=(function(){var Q=function(Y){if(!Y||!Y.replace){return Y}return Y.replace(/&/g,"&amp;").replace(/</g,"&lt;")};var y=function(Y){alert("ERROR\n"+Y)};var k=function(Y){alert("Warning\n"+Y)};var i=function(Z,Y){console.log(Z)};var S=function(aa,Z,Y){if(aa&&Z){y=aa;k=warningFn}else{reportError("You need to specify both errorFn and warningFn for re-plumbing logging with pipeLogging() method");return}if(Y){i=Y}};var D=function(Y){alert(Y)};var a=function(aa){if(!aa||!aa.length){alert("There are no messages")}var Z=[];for(var Y=0;Y<aa.length;Y++){var ab=aa[Y];if(ab.messageType){Z.push(ab.messageType.toUpperCase());Z.push("\n")}if(ab.fieldName){Z.push("Field : ");Z.push(ab.fieldName);Z.push(" - ")}Z.push(ab.text);Z.push("\n\n")}D(Z.join(""))};var n=function(Y){D=Y};var e=function(Y){a=Y};var R=function(af,ad){if(Array.isArray(af)){i("Simplity funciton pushDataToPage() requires that the json is an object-map, but not an array. Data not pushed to page");return}if(!ad){ad=window.document}var aa=X(ad);for(var ab in af){if(ab.indexOf("_")===0){i("Ignoring the reserved attribute "+ab);continue}var Y=af[ab];var ag;if(Y===null||Array.isArray(Y)){if(!Y){Y=[]}ag=ad.getElementById(POCOL.COL_MARKER+ab+POCOL.COL_MARKER);if(ag){O(ag,Y||[],ab);continue}ag=ad.getElementById(ab);if(ag&&ag.getAttribute(POCOL.DATA_TABLE)){G(ag,Y||[],ab);continue}var ah=aa&&aa[ab];if(ah){for(var Z=ah.length-1;Z>=0;Z--){u(ah[Z],Y||[])}continue}if(Y){i("No destination found for table "+ab);continue}}ag=ad.getElementById(ab);if(ag){b(ag,ab,Y);continue}var ae=ad.getElementById(ab+"-true");var ac=ad.getElementById(ab+"-false");if(ae||ac){A(ae,ac,Y);continue}}};var u=function(ac,ab){var aa=ac.options;var ae=null;if(aa&&aa.length){aa=aa[ac.selectedIndex];ae=aa&&aa.value}var Z=[];var af=ab.length;for(var Y=0;Y<af;Y++){var ad=ab[Y];Z.push('<option value="');Z.push(ad.key);if(ae&&ae==ad.key){ae=null;Z.push('" selected="selected">')}else{Z.push('">')}Z.push(Q(ad.value));Z.push("</option>")}ac.innerHTML=Z.join("")};var O=function(aj,af,ae){var Y=af.length;aj.style.display="none";var ag=aj.parentNode;if(!Y){i("No data in table "+ae);ag.innerHTML=aj.outerHTML;return}ag.style.display="none";var ah=[aj.outerHTML];aj.style.display="";var Z=aj.outerHTML.split(POCOL.COL_MARKER);var ab=Z.length;if(ab%2!==1){y("Element for table "+ae+" does not follow the convention proerly. Look for pairs of "+POCOL.COL_MARKER);return}for(var aa=0;aa<Y;aa++){var ai=af[aa];ah.push(Z[0]);ah.push(ae+"_"+aa);ah.push(Z[2]);var ad=3;while(ad<ab){var ac=Z[ad];ad++;if(ac==="i"){ah.push(aa+1)}else{if(ai.hasOwnProperty(ac)){ah.push(x(ai[ac]))}else{i("No value for column "+ac+". cell value set to empty string")}}ah.push(Z[ad]);ad++}}ag.innerHTML=ah.join("");aj.style.display="none";ag.style.display=""};var G=function(ae,ab,Z){var Y=F(ae);var ac=Y.parentNode;if(!ab||!ab.length){if(ae.hasAttribute(POCOL.HIDE_IF_NO_DATA)){i("No data in table "+Z+" and hence we are hiding the table element");ae.style.display="none"}else{i("No data in table "+Z);Y.style.display="none";ac.innerHTML=Y.outerHTML}return}var ad=o(ae,Z,false);var aa=[];P(ad,{},ab,aa,"");ac.innerHTML=aa.join("");if(ae.hasAttribute(POCOL.HIDE_IF_NO_DATA)){ae.style.display=""}return};var F=function(Z){var aa=Z.firstChild;while(aa){if(aa.hasAttribute){if(aa.hasAttribute(POCOL.DATA_ROW)){return aa}var Y=F(aa);if(Y){return Y}}aa=aa.nextSibling}return null};var j="___";var o=function(ae,Z,af){var Y=F(ae);if(!Y){y("Element "+ae.id+" is marked as data-table, but it does not have a child ele marked as data-row");return null}var ad=null;ad=[];var ab=null;if(af){var ac=Y.parentNode;ac.insertBefore(document.createTextNode(j),Y);ac.removeChild(Y);var aa=ae.outerHTML.split(j);if(aa.length!=2){y("we assume that you have no need to use three underscores together anywhere, but found one such instance in your html");return null}g(ad,aa[0]);ab=aa[1]}Y.style.display="none";ad.push({html:Y.outerHTML});Y.style.display="";ad.startAt=ad.length;if(ae.hasAttribute(POCOL.HAS_CHILDREN)){T(ad,Y)}else{g(ad,Y.outerHTML)}ad.endBefore=ad.length;if(ab){g(ad,ab)}return ad};var g=function(ac,ab){var aa=ab.split(POCOL.COL_MARKER);var ad=aa.length;if(ad%2!==1){y("We assume that you use double underscore as delimiter for marking tabl elements, like __colName__, Since this is ot true, we are unabel to set data to table.");return}ac.push({html:aa[0]});for(var Z=1;Z<ad;Z++){var Y=aa[Z];if(Y===POCOL.IDX_MARKER){ac.push({id:true})}else{ac.push({col:Y})}Z++;ac.push({html:aa[Z]})}return};var T=function(ae,aa){var ad=aa.cloneNode();ad.innerHTML=j;var Y=ad.outerHTML.split(j);if(Y.length!=2){y("Our algorithm for setting data to table assumes that your html has no triple underscores. Please remove them from your html");return}var ac=[Y[0]];ad=aa.firstChild;while(true){if(!ad){if(ac.length){g(ae,ac.join(""))}break}if(!ad.getAttribute){ac.push(ad.nodeValue)}else{var Z=ad.getAttribute(POCOL.DATA_TABLE);if(!Z){ac.push(ad.outerHTML)}else{if(ac.length){g(ae,ac.join(""));ac=[]}var ab=o(ad,Z,true);ae.push({child:Z,parts:ab})}}ad=ad.nextSibling}ae.push({html:Y[1]});return};var P=function(ad,ai,Z,ag,ae){var ah=ad.startAt;for(var af=0;af<ah;af++){ag.push(l(ad[af],ai,ae))}var ah=ad.endBefore;var aa=!Z?0:Z.length;for(var ac=0;ac<aa;ac++){var aj=Z[ac];var Y=ae+"_"+ac;for(var af=ad.startAt;af<ah;af++){var ab=ad[af];if(ab.child){P(ab.parts,aj,aj[ab.child],ag,Y)}else{ag.push(l(ab,aj,Y))}}}ah=ad.length;for(var af=ad.endBefore;af<ah;af++){ag.push(l(ad[af],ai,ae))}};var l=function(Z,ab,aa){var Y=Z.html;if(Y){return Y}if(Z.id){return aa}Y=Z.col;if(ab&&ab.hasOwnProperty(Y)){return x(ab[Y])}return""};var x=function(Y){if(Y&&Y.toLocaleDateString){Y=Y.toLocaleDateString()}else{Y=Q(Y)}return Y};var X=function(af){var Y=af.getElementsByTagName("select");var ac=0;var aa={};for(var ab=Y.length-1;ab>=0;ab--){var ae=Y[ab];var Z=ae.getAttribute(POCOL.DATA_TABLE);if(Z){var ad=aa[Z];if(!ad){ad=aa[Z]=[]}ad.push(ae);ac++}}if(ac){return aa}return null};var C=function(aa){if(!Array.isArray(aa)){i("Simplity function downloadCsv() requires that the json to be an array. Data not pushed to page");return}var Y="";for(var ab=0;ab<aa.length;ab++){var ae="";for(var Z in aa[ab]){ae+='"'+aa[ab][Z]+'",'}ae.slice(0,ae.length-1);Y+=ae+"\r\n"}for(var ab=0;ab<aa.length;ab++){var ae="";for(var Z in aa[ab]){ae+='"'+aa[ab][Z]+'",'}ae.slice(0,ae.length-1);Y+=ae+"\r\n"}if(Y==""){alert("Invalid data");return}var af="download";var ad="data:text/csv;charset=utf-8,"+escape(Y);var ac=document.createElement("a");ac.href=ad;ac.style="visibility:hidden";ac.download=af+".csv";document.body.appendChild(ac);ac.click();document.body.removeChild(ac)};var A=function(aa,Y,Z){if(Y){Y.style.display==aa?"":"none"}if(Z){Z.style.display==aa?"none":""}};var b=function(ae,af,ad){if(ad==null){fieldVaue=""}var Z=ae.tagName.toLowerCase();if(Z==="input"){if(ae.type.toLowerCase()==="checkbox"){ae.checked=ae.value?true:false}else{ae.value=ad}return}if(Z==="select"){if(ae.multiple){var ac=getVals(ad);var ab=ae.firstChild;while(ab){if(ac[ab.value]){ae.setAttribute("selected","selected")}else{ae.removeAttribute("selected")}ab=ab.nextSibling}}else{ae.value=ad}return}if(ae.hasAttribute("data-value")){ae.setAttribute("data-value",ad);return}if(ae.hasAttribute("data-radio")){var Y=ae.getElementsByTagName("input");if(!Y.length){i("we found tag for "+af+" as data-radio but it does not have radio child nodes");return}for(var aa=Y.length-1;aa>=0;aa--){var ab=Y[aa];ab.checked=ab.value==ad}return}if(ae.hasAttribute("data-checkbox")){var ac=getVals(ad);var Y=ae.getElementsByTagName("input");if(!Y.length){i("we found tag for "+af+" but it does not have check-box child nodes");return}for(var aa=Y.length-1;aa>=0;aa--){var ab=Y[aa];ab.checked=ac[ab.value]}return}ae.textContent=ad};var w="POST";var H="a._s";var I="a._f";var L="a._i";var K="a._o";var q=12000;var d=null;var M=function(aa,ab,Y,Z){Y=Y||R;Z=Z||a;var ae=new XMLHttpRequest();ae.onreadystatechange=function(){if(this.readyState!="4"){return}var ag={};if(ae.responseText){ag=JSON.parse(ae.responseText)}if(ae.status&&ae.status!=200){i("HTTP error from server (non-200)\n"+ae.responseText);Z(p("Server or the communication infrastructure has failed to respond."));return}var af=ag[POCOL.REQUEST_STATUS]||POCOL.STATUS_OK;if(af==POCOL.STATUS_OK){Y(ag)}else{if(ag[POCOL.MESSAGES]){Z(ag[POCOL.MESSAGES])}else{Z(p("Login failed"))}}};ae.ontimeout=function(){Z(p("Sorry, there seem to be some red-tapism on the server. Can't wait any more for a decision. Giving up."))};try{ae.open(w,L,true);ae.timeout=q;ae.setRequestHeader("Content-Type","text/html; charset=utf-8");var ad=aa;if(ab){ad+=" "+ab}ae.setRequestHeader(POCOL.USER_TOKEN,ad);ae.send("")}catch(ac){Z(p("Unable to connect to server. Error : "+ac.message))}};var r=function(){var Z=new XMLHttpRequest();try{Z.open(w,K,true);Z.setRequestHeader("Content-Type","text/html; charset=utf-8");Z.send("")}catch(Y){a(p("Unable to connect to server. Error : "+Y))}};var W=function(aa,ab,Y,Z,ad,af){if(!ab){ab="{}"}else{if(!ab.indexOf){ab=JSON.stringify(ab)}}Y=Y||R;Z=Z||a;if(!aa&&!ad){i("No service");Z(p("No serviceName specified"));return}i("Service "+aa+" invoked");var ae=new XMLHttpRequest();ae.onreadystatechange=function(){if(this.readyState!="4"){return}var ai={};if(ae.responseText){try{ai=JSON.parse(ae.responseText)}catch(ak){i("Response is not json. response text is returned instead of js object....");ai=ae.responseText}}if(ae.status&&ae.status!=200){if(af&&ae.status==404){i("Pending request is still not ready.. will retry again..");V(ah,Y,Z);return}i("HTTP error from server (non-200)\n"+ae.responseText);Z(p("Server or the communication infrastructure has failed to respond."));return}var ag=ai[POCOL.REQUEST_STATUS]||POCOL.STATUS_OK;if(ag==POCOL.STATUS_OK){var ah=ai[POCOL.FILE_TOKEN];i(ah+" is the token "+POCOL.FILE_TOKEN);if(ah){i("Service is pending on the server. We will collect the response later..");V(ah,Y,Z);return}window[POCOL.LAST_JSON]=ai;i("Json saved as "+POCOL.LAST_JSON);Y(ai);return}if(ag==POCOL.STATUS_NO_LOGIN){if(d){i("Login required. invoking relogin");d(aa,ab,Y,Z);return}Z(p("This service requires a valid login. Please login and try again."));return}var aj=ai[POCOL.MESSAGES];if(!aj){aj=p("Server reported a failure, but did not specify any error text.")}Z(aj)};ae.ontimeout=function(){i("time out");Z(p("Sorry, there seem to be some red-tapism on the server. giving-up"))};try{ae.open(w,H,true);ae.timeout=q;if(ad){ae.setRequestHeader(POCOL.FILE_TOKEN,ad)}else{ae.setRequestHeader("Content-Type","text/html; charset=utf-8");ae.setRequestHeader(POCOL.SERVICE_NAME,aa)}ae.send(ab)}catch(ac){i("error during xhr : "+ac.message);Z(p("Unable to connect to server. Error : "+ac.message))}};var V=function(aa,Y,Z){i("Time-out set for token "+aa);setTimeout(function(){W(null,null,Y,Z,aa,true)},3000)};var p=function(Y){return[{messageType:"error",text:Y}]};var m=function(Y){var Z={};Z[POCOL.REQUEST_STATUS]=POCOL.STATUS_ERROR;Z[POCOL.MESSAGES]=p(Y);return Z};var v=function(){var Y={};Y[POCOL.REQUEST_STATUS]=POCOL.STATUS_OK;Y[POCOL.MESSAGES]=[];return Y};var B=function(ac,ae,Y,ab){Y=Y||R;ab=ab||a;if(!ac){i("No service");FailureFn(p("No serviceName specified"));return}if(ae&&ae.length){try{ae=JSON.parse(ae)}catch(af){i("Invaid input json. Assuming that the service is a special one that expects plain text..")}}else{ae={}}i("Service "+ac+" invoked locally");var Z=s.getResponse(ac,ae);i("local response for service "+ac+" :");i(Z);try{Z=JSON.parse(Z)}catch(af){i("Response is not a valid JSON. Assumed to be text and returning text instead of JSON.")}var aa=Z[POCOL.REQUEST_STATUS];if(!aa||aa==POCOL.STATUS_OK){window[POCOL.LAST_JSON]=Z;Y(Z);return}var ad=Z[POCOL.MESSAGES];if(!ad){ad=p("Server indicated failure of service, but offered no explanation!")}ab(ad)};var N=function(aa,Y,Z){i("File "+aa.name+" of mime-type "+aa.mime+" of size "+aa.size+" is being uploaded");if(!Y){y("No callback funciton. We will set window._uploadedFileKey to the returned key")}var ac=new XMLHttpRequest();ac.onreadystatechange=function(){if(this.readyState!="4"){return}var ad=null;if(ac.status&&ac.status!=200){i("File upload failed with non 200 status : "+ac.status)}else{ad=ac.getResponseHeader(POCOL.FILE_TOKEN)}if(Y){Y(ad)}else{window._uploadedFileKey=ad}};ac.ontimeout=function(){i("file upload timed out");if(Y){Y(null)}};if(Z){ac.upload.onprogress=function(ae){if(ae.lengthComputable){var ad=Math.round((ae.loaded*100)/ae.total);Z(ad)}}}try{ac.open(w,I,true);ac.timeout=q;ac.setRequestHeader(POCOL.FILE_NAME,aa.name);i("header field "+POCOL.FILE_NAME+"="+aa.name);if(aa.mime){ac.setRequestHeader(POCOL.MIME_TYPE,aa.mime);i("header field "+POCOL.MIME_TYPE+"="+aa.mime)}ac.send(aa)}catch(ab){y("error during xhr : "+ab);if(Y){Y(null)}}};var h=function(Y){if(!Y){y("No file token specified for discard request");return}var aa=new XMLHttpRequest();try{aa.open(w,I,true);aa.setRequestHeader(POCOL.FILE_TOKEN,Y);aa.setRequestHeader(POCOL.SERVICE_NAME,POCOL.DISCARD);aa.send()}catch(Z){y("error during xhr for discarding token : "+Y+". error :"+Z)}};var J=function(ab,ae,Y,Z,aa){if(!ab){y("No file token specified for download request");return}var ad=new XMLHttpRequest();ad.onloadend=function(){var af=null;if(ad.status&&ad.status!=200){i("non 200 status : "+ad.status);Z(null)}else{af=ad.response}if(Z){Z(af,ae,Y)}else{Simplity.message("We successfully downloaded file for key "+ab+" with content-type="+ad.getResponseHeader("Content-Type")+" and total size of "+ad.getResponseHeader("Content-Length"))}};ad.ontimeout=function(){i("file download timed out");Z(null)};if(aa){ad.onprogress=function(ag){if(ag.lengthComputable){var af=Math.round((ag.loaded*100)/ag.total);aa(af)}}}try{ad.open("GET",I+"?"+ab,true);if(ae||Y){ad.responseType="blob"}ad.send()}catch(ac){y("error during xhr for downloading token : "+ab+". error :"+ac)}};var c=function(aa,Z,ab){ab=ab||"text/plain";var Y=document.createElement("a");Y.download=Z;Y.href=window.URL.createObjectURL(aa);Y.onclick=function(ad){var ac=this;setTimeout(function(){window.URL.revokeObjectURL(ac.href)},1500)};Y.click();Y.remove()};var t=function(Y){d=Y};var E=function(){};var f=function(Y){Y=Y||E;J(POCOL.FILE_NAME_FOR_LOGS,null,null,Y)};var s=(function(){var aj={tables:{},views:{},responses:{}};var ag=function(ap){aj=ap};var aa=function(au,at,ar){if(!at){at={}}if(ar){for(var aq=0;aq<ar.length;aq++){var av=ar[aq];if(au.hasOwnProperty(av)){at[av]=au[av]}}}else{for(var ap in au){at[ap]=au[ap]}}return at};var Y=function(ar,aq,at){if(!aq){aq={}}for(var ap in at){if(ar.hasOwnProperty(ap)){aq[ap]=ar[ap]}}return aq};var ab=function(aq){var at=(aq&&aq.length)||0;var ap=[];for(var ar=0;ar<at;ar++){ap.push(aa(aq[ar]))}return ap};var an=function(aq,av,ar){var ap=[];var aw=aq&&aq.length||0;for(var at=0;at<aw;at++){var au=aq[at];if(au[av]==ar){ap.push(au)}}return ap};var Z=function(at,ap){var ar=[];for(fieldName in at){if(!ap.hasOwnProperty(fieldName)){continue}var aq={name:fieldName,value:ap[fieldName],op:"="};ar.push(aq);var au=ap[fieldName+"Operator"];if(!au){continue}aq.op=au;if(au!="><"){continue}au=ap[fieldName+"To"];if(!au){throw"we expected a value for "+fieldName+"To because the operator is between (><)"}aq.to=au}return ar};var ad=function(ar,aq){var au=ar[aq.name];switch(aq.op){case"=":return aq.value==au;case"!=":return aq.value!=au;case"<":return au<aq.value;case"<=":return aq.value<=au;case">":return au>aq.value;case">=":return aq.value>=au;case"><":return au>aq.value&&au<aq.to;case"^":return au.toUpperCase().indexOf(aq.value.toUpperCase())==0;case"~":return au.toUpperCase().indexOf(aq.value.toUpperCase())!=-1;case"@":var at=aq.value&&aq.value.split(",");var av=at.length||0;for(var ap=0;ap<av;ap++){if(au==at[ap]){return true}}return false}};var al=function(aw,ap){var ay=[];var aq=aw.length||0;var ar=ap.length||0;for(var av=0;av<aq;av++){var ax=aw[av];var au=true;for(var at=0;at<ar;at++){if(!ad(ax,ap[at])){au=false;break}}if(au){ay.push(ax)}}return ay};var ah=function(ar,ax){var ay=ax.length||0;var aw=ar.length||0;if(!ay||!aw){return ax}for(var au=0;au<ay;au++){var az=ax[au];for(var at=0;at<aw;at++){var aq=ar[at];var av=aq.baseField;if(!az.hasOwnProperty(av)){throw"base table does not have the attribute "+av+". Invalid join specification."}var ap=af(aq.joinedTable,null,aq.joinedField,az[av],false);if(ap.length>1){throw"We got "+ap.length+" items as children from "+aq.joinedTable+" with its parent key field "+aq.joinedFeild+" = "+az[aq.fieldName]+" but the join definition has not specified childrenName indicating that we do not expect more than one child items."}if(ap.length){aa(ap[0],az)}else{i("No row from joining table "+aq.joinedTable+" with  "+aq.joinedField+" = "+az[av])}}}};var af=function(ar,at,aq,aw,ax){var aD=aj.tables[ar];if(!aD){throw ar+" is not defined as a table/view under _localData"}var au=ax&&aD.children;i("getting data for table "+ar+" with children = "+au);var aJ={};var ay=[];var aH=null;while(true){aH=aj.tables[ar];if(!aH){throw ar+" is not defined as a table/view under _localData"}if(aH.data){break}aJ[ar]=true;ay.push(aH);ar=aH.baseTable;if(aJ[ar]){throw"We found cyclic dependence of table "+ar}}var aC=aH.data;if(at){aC=an(aC,aH.key,at[aH.key])}else{if(aq){aC=an(aC,aq,aw)}}aC=ab(aC);if(!aC||!aC.length){return aC}for(var aG=ay.length-1;aG>=0;aG--){ah(ay[aG].joins,aC)}if(!au){return aC}i("going to add rows from children "+au);var aE=aC.length;var av=aD.key;var aB={name:av,op:"="};var az=[aB];for(var aG=0;aG<au.length;aG++){var aA=au[aG];var ap=af(aA,null,null,null,true);for(var aF=0;aF<aE;aF++){var aI=aC[aF];aB.value=aI[av];aI[aA]=al(ap,az)}}return aC};var ak=function(ap,ar,au){var av=ap.length;for(var aq=0;aq<av;aq++){var at=ap[aq];if(at[ar]==au){return at}}return null};var ac=function(ar,at){var aw=aj.tables[ar];if(!aw){throw ar+" is not a table and hence data can not be saved using an express service"}var au=aw.key;var ax=at[au];var aq=aw.data;var av=null;if(ax){av=ak(aq,au,ax);if(!av){throw"Item not found for the supplied key. Data can not be saved."}}var ap={};av=Y(at,av,aq[0]);if(!ax){ax=aq[aq.length-1][au];ax++;av[au]=ax;aq.push(av);ap[au]=ax}return ap};var ai=function(au,ay){var ax=aj.tables[au];if(!ax){throw au+" is not a table and hence we are unable to get a list of vname-value pairs"}var av=ax.key;var at=ax.valueFieldName;if(!av||!at){throw au+" need to have attributes key and valueFieldName for us to create a list of name-value pairs"}var az=[];var ar=ax.data;var ap=ar.length;for(var aq=0;aq<ap;aq++){var aw=ar[aq];az.push({key:aw[av],value:aw[at]})}return az};var ae={get:function(ap,aq){var ar=af(ap,aq,null,null,true);var at=v();ar=ar&&ar[0];if(ar){aa(ar,at)}return at},filter:function(aq,ar){var au=af(aq,null,null,null,true);if(au.length&&ar){var at=Z(au[0],ar);if(at.length){au=al(au,at)}}var ap=v();ap[aq]=au;return ap},save:function(ap,aq){return ac(ap,aq)},"delete":function(ap,aq){var ar=aj.tables[ap];if(!ar){throw (ap+" is not a valid table name")}return deleteData(ar,aq)},list:function(aq,ar){var at=ai(aq,ar);var ap=v();ap[aq]=at;return ap},suggest:function(ap,aq){return m("local functionaity for suggest is not yet built")}};var ao=function(ar,ap){var aw=window[POCOL.LOCAL_RESPONSES];aw=aw&&aw[ar];if(aw){i("response located in page-specific response");return aw}aw=window[POCOL.LOCAL_SERVICES];aw=aw&&aw[ar];if(aw){i("service function found in page-specific script");if(typeof(aw)!=="function"){throw aw+" is expected to be a function that returns a valid response to a request for service "+ar}return aw(ap)}aw=aj.responses[ar];if(aw){i("response located in local ready-responses");return aw}var au=ar.split("_");if(au.length>1){var at=au[0];var aq=ae[at];if(aq){var av=ar.substring(at.length+1);i("trying "+at+" for table "+av);return aq(av,ap)}}throw ar+" is not served by the local server."};var am=function(aq,ap){var at=null;try{at=ao(aq,ap)}catch(ar){at=m(ar.message?ar.message:ar)}return JSON.stringify(at)};return{initialize:ag,getResponse:am}})();var U=null;if(window.location.protocol==="file:"){if(!window.sessionStorage){alert("Sorry, your browser setting does not allow certain features when html is opened from file-system. Use a different browser, or see if you can enable sessionStorage feature using any setting options.");return}var z=sessionStorage[POCOL.LOCAL_STORAGE_NAME];if(z){i("Session storage found in session");U=JSON.parse(z)}else{U=window[POCOL.LOCAL_STORAGE_NAME];if(U){i("local storage found as windows variable..");sessionStorage[POCOL.LOCAL_STORAGE_NAME]=JSON.stringify(U)}}if(U){s.initialize(U);window.addEventListener("beforeunload",function(){sessionStorage[POCOL.LOCAL_STORAGE_NAME]=JSON.stringify(U)})}else{i("local storage NOT found")}W=B}return{log:i,error:y,warn:k,pipeLogging:S,showMessage:D,showMessages:a,overrideShowMessage:n,overrideShowMessages:e,getResponse:W,login:M,logout:r,pushDataToPage:R,uploadFile:N,discardFile:h,downloadFile:J,registerRelogin:t,getLogs:f,htmlEscape:Q,downloadCsv:C}})();